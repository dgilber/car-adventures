<!DOCTYPE html>
<html>
<head>
<title>Car Adventures - Gilbert Games</title>

<style>
html, body {
    background-color: rgb(100, 200, 255);
    margin: 0;
    padding: 0;
}

.car-frame {
    background-image: url(images/car_frame.png);
    background-repeat: no-repeat;
    background-size: 100%;
    position: absolute;
    top: 250px;
    left: 100px;
    width: 200px;
    height: 150px;
    z-index: 10;
}

.wheel {
    background-image: url(images/wheel.png);
    background-repeat: no-repeat;
    background-size: 100%;
    position: absolute;
    top: 60px;
    width: 45px;
    height: 45px;
}
.wheel.rear {
    left: 20px;
}
.wheel.front {
    left: 135px;
}

.gauge {
    background-image: url(images/fuel_gauge.png);
    background-repeat: no-repeat;
    background-size: 100%;
    position: absolute;
    top: 40px;
    width: 200px;
    height: 200px;
}

.fuel {
    right: 100px;
}

#fuel_needle {
    position: relative;
    /* width: 200px; */
    /* height: 200px; */
    /* background-color: rgba(255,0,0,0.2); */ /* debug */
}

.road {
    position: absolute;
    top: 300px;
    width: 100%;
    height: 600px;
    background-color: #666666;
}

</style>

<script src="lib/jquery.js"></script>
<script>

function start_wheels() {
    var wheels = $('.wheel')
    var degree = 0;
    setInterval(
        function () {
            degree = degree + 20;
            if (degree == 360) {
                degree = 0;
            }
            wheels.css('transform', 'rotate(' + degree + 'deg)');
        },
        20  // milliseconds
    )
}

function set_fuel_level (level) {
    // level is integer between 0 and 100
    var center = point(80, 90)
    var r = 60;
    var dr = 125;
    var d = (dr * (level / 100)) - (dr / 2)
          + 8;  // +8 because drawing isn't completely vertical
    if (d < 0) {
        d += 360;
    }
    var edge = circleEdge(center, r, d);
    var edgeY = center.y + (center.y - edge.y);
    console.log('level: %s, degree: %d, edge: [%d, %d]', level, d, edge.x, edgeY);
    
    var canvas = document.getElementById('fuel_needle');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = 'rgb(50, 50, 50)';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(center.x, center.y);
    ctx.lineTo(edge.x, edgeY);
    ctx.stroke();
    ctx.closePath();
}

function circleEdge (center, radius, degree) {
    return point(
        center.x + radius * Math.cos(_toRad(degree)),
        center.y + radius * Math.sin(_toRad(degree))
    );
}

function point (x, y) {
    return {x, y};
}

function _toRad (d) {
    return d * Math.PI / 180;
}

</script>
</head>

<body>
 <h1>Car Adventures</h1>

 <div class="car-frame">
  <div class="wheel rear"></div>
  <div class="wheel front"></div>
 </div>
 <div class="fuel gauge">
  <canvas id="fuel_needle" width="200" height="200"></canvas>
 </div>
 <div class="road"></div>

 <input type="range" name="fuel_controller" min="0" max="100" step="1" value="100" onchange="set_fuel_level(this.value)">
<script>
    start_wheels();
    set_fuel_level(100);
</script>

</body>
</html>
